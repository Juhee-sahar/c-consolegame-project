#include "common.h"    
#include "opening.h"

#define UP 0
#define DOWN 1
#define LEFT 2
#define RIGHT 3
#define SUBMIT 4  // ì„ íƒ (ìŠ¤í˜ì´ìŠ¤ë°”)

int menuDraw();
int keyControl();
void init();
void titleDraw();
void gotoxy(int,int);
void infoDraw();   //ê²Œì„ì •ë³´
// void charicter();
int chari();
void charicter_choice();
int getch_opening();

GameState playerstate = {
    .emoji = 0,
    .point = 0 
};


int open_opening()       /////////////////////////////ë©”ì¸ì°½////////////////////////////////////
{
    init();
    
    squidGame_5();  // ì•„íŠ¸ ì¶œë ¥
    sleep(2);
    system("clear");
    first();
    sleep(3);
    system("clear");

    while(1)
    {
        titleDraw();
        int menuCode = menuDraw();
        if (menuCode == 0)  // ê²Œì„ì‹œì‘
        {
            charicter_choice();
            return 1;
        }
        else if (menuCode == 1)
        {
            infoDraw();  // ê²Œì„ì •ë³´
        }
        else if (menuCode == 2)
        {
            return 0;   // ì¢…ë£Œ
        }
        system("clear");
    }


    return 0;
}

int keyControl()
{
    char temp = getch_opening();

    if (temp == 'w' || temp == 'W'){ 
        return UP; 
    } else if (temp == 'a' || temp == 'A'){
        return LEFT;
    } else if (temp == 's' || temp == 'S'){
        return DOWN;
    } else if (temp == 'd' || temp == 'D'){
        return RIGHT;
    } else if (temp == ' '){   // ìŠ¤í˜ì´ìŠ¤ë°”(ê³µë°±)ì´ ì„ íƒ ë²„íŠ¼
        return SUBMIT;
    }

    return -1;
}



void titleDraw()
{
    printf("\n\n\n\n");
    printf("â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›\n");
    printf("â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›\n");
    printf("â¬›â¬›â­ï¸â­ï¸â­ï¸â­ï¸â¬›â¬›â­ï¸â­ï¸â­ï¸â¬›â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â­ï¸â¬›â­ï¸â­ï¸â­ï¸â­ï¸â¬›â¬›â¬›â¬›â­ï¸â­ï¸â­ï¸â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â¬›\n");
    printf("â¬›â­ï¸â¬›â¬›â¬›â¬›â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â­ï¸â¬›â¬›â¬›â¬›â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â­ï¸â­ï¸â¬›â­ï¸â­ï¸â¬›â­ï¸â¬›â¬›â¬›â¬›â¬›\n");
    printf("â¬›â¬›â­ï¸â­ï¸â­ï¸â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â­ï¸â¬›â­ï¸â­ï¸â¬›â¬›â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â¬›â­ï¸â¬›â­ï¸â¬›â­ï¸â¬›â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â¬›\n");
    printf("â¬›â¬›â¬›â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â­ï¸â¬›â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â¬›â¬›\n");
    printf("â¬›â­ï¸â­ï¸â­ï¸â­ï¸â¬›â¬›â¬›â­ï¸â­ï¸â¬›â­ï¸â¬›â¬›â­ï¸â­ï¸â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â­ï¸â­ï¸â­ï¸â¬›â¬›â¬›â¬›â­ï¸â­ï¸â­ï¸â¬›â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â¬›â¬›â¬›â­ï¸â¬›â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â¬›\n");
    printf("â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›\n");
    printf("â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›\n");


}

void init()    // í”„ë¡œê·¸ë¨ ì‹¤í–‰ì§í›„ ì´ˆê¸°í™” ì‘ì—…card_art()
{
    system("clear");   // í™”ë©´ ì§€ìš°ê¸°
    printf("\033[?25l"); // ì»¤ì„œ ìˆ¨ê¸°ê¸° (í•„ìš” ì‹œ)
    // printf("\033[?25h");   //ì»¤ì„œ ë‹¤ì‹œ ë³´ì´ê²Œ
}


void gotoxy(int x, int y)   // ì»¤ì„œ ìœ„ì¹˜ ì´ë™í•˜ëŠ” í•¨ìˆ˜
{
    printf("\033[%d;%dH", y, x);
}

int menuDraw()
{
    int x = 42;   //ê°€ë¡œ
    int y = 16;    //ì„¸ë¡œ

    gotoxy(x-2, y); // - 2 í•œ ì´ìœ ëŠ” > ë¥¼ ì¶œë ¥í•´ì•¼ í•˜ê¸° ë•Œë¬¸

    printf(">   ê²Œ ì„ ì‹œ ì‘ ");
    gotoxy(x, y+1);
    printf("  ê²Œ ì„ ì • ë³´");
    gotoxy(x, y+2);
    printf("     ì¢…  ë£Œ    \n");

    while (1)
    {
        int n = keyControl();      //í‚¤ë³´ë“œ ì´ë²¤íŠ¸ë¥¼ í‚¤ê°’ìœ¼ë¡œ ë°›ì•„ì˜¤ê¸°
        switch(n){
            case UP : {              // ì…ë ¥ëœ í‚¤ì˜ ê°’ì´ UPì¸ ê²½ìš°(W)
                if ( y>16 ){         // yëŠ” 12~14ê¹Œì§€ë§Œ ì´ë™
                    gotoxy(x-2, y);  // x-2 í•˜ëŠ” ì´ìœ ëŠ” ">"ë¥¼ ë‘ì¹¸ ì´ì „ì— ì¶œë ¥í•˜ê¸° ìœ„í•´
                    printf(" ");      // ì›ë˜ ìœ„ì¹˜ë¥¼ ì§€ìš°ê³ 
                    gotoxy(x-2, --y);  // ìƒˆë¡œ ì´ë™í•œ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì—¬
                    printf(">");       // ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                }
                break;
            }

            case DOWN : {              // ì…ë ¥ëœ í‚¤ì˜ ê°’ì´ DOWN ì¸ ê²½ìš°(S)
                if ( y < 18 ){        // ìµœëŒ€ 14
                    gotoxy(x-2, y);
                    printf(" ");
                    gotoxy(x-2, ++y);
                    printf(">");
                }
                break;
            }

            case SUBMIT : {
                return y-16;     // ìŠ¤í˜ì´ìŠ¤ë°”(ì„ íƒ) ë˜ì—ˆì„ ê²½ìš° y-12
                // y ì‹œì‘ ìœ„ì¹˜ê°€ 12ì˜€ìœ¼ë¯€ë¡œ y-12ë¥¼ í•˜ë©´ 0,1,2 ì„¸ ìˆ«ìë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤
            }
        }
    }

    return 0;
}

void infoDraw()   //ê²Œì„ì •ë³´ì°½
{
    system("clear");
    card_art();
    printf("\n\n\n");
    printf("                                [ ì¡° ì‘ ë²• ]\n\n");
    printf("                             ì´ ë™ : W, A, S, D\n");
    printf("                             ì„  íƒ : ìŠ¤í˜ì´ìŠ¤ë°” \n\n\n\n");
    printf("                 ê°œ ë°œ ì : ë°ì´ë¹—, ë¼í‘¸ë¼í‘¸, ì˜¤ì•¼ë¶•, SAHAR\n\n");
    printf("                ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆ„ë¥´ë©´ ë©”ì¸í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.\n");

    while(1)
    {
        if (keyControl() == SUBMIT)
        {
            break;
        }
    }
}


////////////ìºë¦­í„°ì°½ ë°©ë²•1//////////////////

int chari() 
{
    int x = 40;   //ê°€ë¡œ
    int y = 14;    //ì„¸ë¡œ

    gotoxy(x-2, y); // - 2 í•œ ì´ìœ ëŠ” > ë¥¼ ì¶œë ¥í•´ì•¼ í•˜ê¸° ë•Œë¬¸
    printf(">   ğŸ‘¦ (ì„±ê¸°í›ˆ) ");
    gotoxy(x, y+1);
    printf("  ğŸ§” (ë°•ì˜ì‹)");
    gotoxy(x, y+2);
    printf("  ğŸ‘§ (ì¤€í¬)");
    gotoxy(x, y+3);
    printf("  ğŸ‘µ (ì¥ê¸ˆì)");
    // gotoxy(x, y+4);
    // printf("  â†©ï¸  ë’¤ë¡œê°€ê¸°");
    

    while (1)
    {
        int n = keyControl();      //í‚¤ë³´ë“œ ì´ë²¤íŠ¸ë¥¼ í‚¤ê°’ìœ¼ë¡œ ë°›ì•„ì˜¤ê¸°
        switch(n){
            case UP : {              // ì…ë ¥ëœ í‚¤ì˜ ê°’ì´ UPì¸ ê²½ìš°(W)
                if ( y>14 ){        
                    gotoxy(x-2, y);  // x-2 í•˜ëŠ” ì´ìœ ëŠ” ">"ë¥¼ ë‘ì¹¸ ì´ì „ì— ì¶œë ¥í•˜ê¸° ìœ„í•´
                    printf(" ");      // ì›ë˜ ìœ„ì¹˜ë¥¼ ì§€ìš°ê³ 
                    gotoxy(x-2, --y);  // ìƒˆë¡œ ì´ë™í•œ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì—¬
                    printf(">");       // ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                }
                break;
            }

            case DOWN : {              // ì…ë ¥ëœ í‚¤ì˜ ê°’ì´ DOWN ì¸ ê²½ìš°(S)
                if ( y < 18 ){        
                    gotoxy(x-2, y);
                    printf(" ");
                    gotoxy(x-2, ++y);
                    printf(">");
                }
                break;
            }

            case SUBMIT : {
                return y-14;   
            }
        }
    }
}

void charicter_choice()
{
    system("clear");

    int x = 20;   //ê°€ë¡œ
    int y = 5;    //ì„¸ë¡œ
    gotoxy(x,y);
    printf("========================================================");
    gotoxy(30,8);
    printf("        ìºë¦­í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.\n");
    gotoxy(x,10);
    printf("========================================================");
    gotoxy(x,20);
    printf("========================================================");

    int selected = chari();  // 0~3 ì¤‘ í•˜ë‚˜ ë°˜í™˜ë¨

    if (selected == 4)
        return;   // ë©”ì¸ë©”ë‰´ë¡œ ëŒì•„ê°

    system("clear");

    switch (selected)
    {
        case 0:
            gamer456();
            printf("\n           1ë²ˆ ì„±ê¸°í›ˆë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.\n");
            playerstate.emoji = 0;

            break;
        case 1:
            gamer007();
            printf("\n           2ë²ˆ ë°•ì˜ì‹ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.\n");
            playerstate.emoji = 1;

            break;
        case 2:
            gamer222();
            printf("\n           3ë²ˆ ì¤€í¬ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.\n");
            playerstate.emoji = 2;

            break;
        case 3:
            gamer149();
            printf("\n           4ë²ˆ ì¥ê¸ˆìë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.\n");
            playerstate.emoji = 3;

            break;

    }

    sleep(2);  // ì¶œë ¥ ìœ ì§€
}

int getch_opening()   // í•œê¸€ì ì…ë ¥ì„ ë°”ë¡œ ë°›ì„ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í•¨ìˆ˜
{
    int c;
    struct termios oldattr, newattr;

    tcgetattr(STDIN_FILENO, &oldattr); // í˜„ì¬ í„°ë¯¸ë„ ì„¤ì • ì½ìŒ
    newattr = oldattr;
    newattr.c_lflag &= ~(ICANON | ECHO);        // CANONICALê³¼ ECHO ë”
    newattr.c_cc[VMIN] = 1;                     // ìµœì†Œ ì…ë ¥ ë¬¸ì ìˆ˜ë¥¼ 1ë¡œ ì„¤ì •
    newattr.c_cc[VTIME] = 0;                    // ìµœì†Œ ì½ê¸° ëŒ€ê¸° ì‹œê°„ì„ 0ìœ¼ë¡œ ì„¤ì •
    tcsetattr(STDIN_FILENO, TCSANOW, &newattr); // í„°ë¯¸ë„ì— ì„¤ì • ì…ë ¥
    c = getchar();                              // í‚¤ë³´ë“œ ì…ë ¥ ì½ìŒ
    tcsetattr(STDIN_FILENO, TCSANOW, &oldattr); // ì›ë˜ì˜ ì„¤ì •ìœ¼ë¡œ ë³µêµ¬
    return c;
}
